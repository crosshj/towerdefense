<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>DB Test</title>
		<meta
			name="viewport"
			content="width=device-width,initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"
		/>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="full-screen" content="true" />
		<meta name="screen-orientation" content="portrait" />
		<meta name="x5-fullscreen" content="true" />
		<meta name="360-fullscreen" content="true" />
		<meta name="renderer" content="webkit" />

		<link href="css.css" rel="stylesheet" />

		<script src="js/dragonBones.js"></script>
	</head>
	<body>
		<canvas id="test-canvas" width="128" height="128"></canvas>
		<script type="module">
			import { POJFactory, POJArmatureDisplay } from './test.js';

			const canvas = document.getElementById('test-canvas');
			const em = new POJArmatureDisplay(null);
			const dbInstance = new dragonBones.DragonBones(em);
			const factory = new POJFactory(dbInstance, canvas);

			await factory.loadData({
				skeleton: './base_fighter_ske.json',
				atlas: './base_fighter_tex.json',
				texture: './base_fighter_tex.png'
			});

			window.armature = factory.buildArmatureDisplay('Armature');
			//console.log({ armature });

			let anim = 'look_up';
			armature.animation.play(anim);
			const switchAnim = () => {
				const newAnim = anim === 'run' ? 'look_up' : 'run';
				anim = newAnim;
				armature.animation.play(newAnim);
			};

			let count = 0;
			setInterval(() => {
				count++;
				if (count === 300) {
					count = 0;
					switchAnim();
				}
				factory.advanceTime(1 / 60);
			}, 1000 / 80);
			window.factory = factory;
		</script>
	</body>
</html>
